<section class="training-form">
  <mat-card class="training-card">
    <div class="card-header">
      <h2>Finalizar treino</h2>
      <p>Selecione um treino e registre as cargas.</p>
    </div>

    <div class="form-grid">
      <div class="form-block">
        <label class="field-label">Treino</label>
        <mat-form-field appearance="outline" class="full-field" color="primary">
          <mat-select [value]="selectedWorkoutId" (selectionChange)="onWorkoutChange($event.value)">
            <mat-option *ngFor="let workout of workouts" [value]="workout.id">
              {{ workout.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-block" *ngIf="exerciseRows.length">
        <div class="section-title">Exercícios</div>
        <div class="exercise-list">
          <div class="exercise-row" *ngFor="let row of exerciseRows">
            <div class="field-group">
              <label class="field-label">Exercício</label>
              <div class="field-value">{{ row.name }}</div>
            </div>

            <div class="field-group">
              <label class="field-label">Séries</label>
              <mat-form-field appearance="outline" class="full-field" color="primary">
                <input
                  matInput
                  type="number"
                  min="1"
                  [value]="row.sets"
                  [disabled]="row.locked"
                  (input)="row.sets = $any($event.target).valueAsNumber"
                />
              </mat-form-field>
            </div>

            <div class="field-group">
              <label class="field-label">Repetições</label>
              <mat-form-field appearance="outline" class="full-field" color="primary">
                <input
                  matInput
                  type="number"
                  min="1"
                  [value]="row.reps"
                  [disabled]="row.locked"
                  (input)="row.reps = $any($event.target).valueAsNumber"
                />
              </mat-form-field>
            </div>

            <div class="field-group">
              <label class="field-label">Peso (kg)</label>
              <mat-form-field appearance="outline" class="full-field" color="primary">
                <input
                  matInput
                  type="number"
                  min="0"
                  [value]="row.weightKg"
                  [disabled]="row.locked"
                  (input)="row.weightKg = $any($event.target).valueAsNumber"
                />
              </mat-form-field>
            </div>

            <div class="row-actions">
              <button
                mat-icon-button
                color="primary"
                aria-label="Confirmar linha"
                [disabled]="row.locked"
                (click)="toggleRowLock(row)"
              >
                <mat-icon>{{ row.locked ? 'check_circle' : 'check' }}</mat-icon>
              </button>
              <button
                mat-icon-button
                aria-label="Editar linha"
                [disabled]="!row.locked"
                (click)="toggleRowLock(row)"
              >
                <mat-icon>{{ row.locked ? 'edit' : 'edit_off' }}</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <mat-card-actions align="end">
      <button
        mat-flat-button
        color="primary"
        (click)="save()"
        [disabled]="!canSave()"
      >
        Salvar
      </button>
    </mat-card-actions>
  </mat-card>
</section>
